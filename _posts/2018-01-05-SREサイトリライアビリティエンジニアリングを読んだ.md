---
id: 570
title: SREサイトリライアビリティエンジニアリングを読んだ (随時更新)
date: 2018-1-5T11:59:00+09:00
author: kter
layout: post
image: 
categories:
  - 読書
tags:
  - 読書
  - SRE
---

SREサイトリライアビリティエンジニアリングを読んだので、要点をメモ。

## 現行のシステム管理の問題点

* サービスが成長すると運用コストも増加する
* 開発チームと運用チームでの対立が発生する

## Googleのシステム管理について

* SRE (サイトリライアビリティエンジニアリング) というアプローチを取る
* SREとは(Google的には)ソフトウェアエンジニアに運用チームの設計を依頼したときにできるもの
* UNIXシステム内部とネットワーキングに関する専門知識と、複雑な問題を解決するソフトウェアシステムの開発に対する信念と適正が必要
* 運用チームで行ってきたことをソフトウェアで自動化する
  * こうしたことをしない場合、サービス成長とともに運用負荷が増大し続け、多くの人員が必要となる
* Googleの場合、運用の業務は全体の50%の時間以内に収めるようにしている
  * 残りの時間はサービスを安定して運用できるようにするための開発作業に当てる

## エラーバジェットについて

* 開発チームとSREチームの対立を解決するための仕組み
* 100%を信頼性の目標とすることは、基本的にいかなる場合にも間違っているとする
    * 99.999%と100%の可用性は、他の要素（PC/SP, Wi-Fi, ISP, 電力網等)のノイズに紛れてしまう上に、0.001%を埋める労力はユーザーにメリットがない
* 次の3点を考慮に入れた上で可用性のターゲットを決める。1からそれを引いたものがエラーバジェットとなる (可用性が99.9%の場合は0.1%がエラーバジェット)
    * ユーザーが満足する可用性のレベル
    * 満足できなかったユーザーにとっての大対策はどのようなものがあるか
    * 可用性のレベルを変更したとしてユーザーのプロダクトの利用の仕方にに何が起こるか
* エラーバジェットは超過しない限り自由に使うことができる
  * 機能のローンチに関わるリスク (段階的ロールアウトや1% experiment)のために使うことができる
  * SREの目的をサービス障害をゼロにすることではなく機能のリリース速度を最大化するためにエラーバジェットを使うことになる
  * サービス障害を予測済みのものにすることができ、これが悪いことではなくなる。コントロールすることができるようになる。

## モニタリングについて

* 人間がメールを読み、何らかの対応アクションの必要性を判断しなければならないシステムは根本的に問題がある
  * アラートはソフトウェアが解釈を行い、人間はアクションを行わなければならないときのみ通知を受けるようになっているべき
* MTTF (平均故障時間)とMTTR (平均修復時間)を考える
* たとえ障害が多くとも、手作業での介入を必要としないシステムは、介入を必要とする障害が少ないシステムより高い可用性を持つ
* 人間の作業は手順書に記録していくことで、MTTRに3倍の改善が見られた (Google談)
* およそ70%のサービス障害は動作中のシステム変更によって生じるもの (Googleの場合)
* ベストプラクティスは自動化によって下記3点を実現すること。
  * 漸進的なロールアウトの実装
  * 高速かつ正確な問題の検出
  * 安全なロールバック
* 需要予測とキャパシティプランニングは次の2点を考慮に入れる必要がある。
  * 自然な成長 (プロダクトの利用が進むなど)
  * 突発的な成長 (機能のリリースやマーケティングキャンペーン等)
